version: 2
project_name: vx
release:
  github:
    owner: loonghao
    name: vx
  prerelease: auto
  name_template: '{{.ProjectName}}-v{{.Version}}'
  header: "## \U0001F680 vx {{ .Tag }} ({{ .Date }})\n\nWelcome to this new release of vx - Universal Development Tool Manager!\n\n### \U0001F3AF Performance Optimizations\nThis release includes **Profile-Guided Optimization (PGO)** for maximum performance:\n- ⚡ **Faster startup time** - Up to 20% improvement\n- \U0001F3AF **Better branch prediction** - Optimized hot code paths\n- \U0001F4C8 **Reduced cache misses** - Improved instruction locality\n- \U0001F525 **Real-world optimized** - Based on actual usage patterns\n\n### \U0001F4E6 Download Options\n- **PGO-Optimized** (recommended): Files ending with `_pgo`\n- **Standard**: Regular builds for compatibility\n"
  footer: "## \U0001F64F Thanks!\n\nThose were the changes on {{ .Tag }}!\n\n### \U0001F4CA Performance Notes\n- PGO builds are optimized for common usage patterns\n- Standard builds are available for all platforms\n- Both versions are fully compatible\n\n**Made with ❤️ for developers, by developers**\n"
  mode: replace
winget:
  - name: vx
    package_identifier: Hal.vx
    publisher: Hal
    publisher_url: https://github.com/loonghao/vx
    publisher_support_url: https://github.com/loonghao/vx/issues/new
    copyright: 2025 Hal
    repository:
      owner: microsoft
      name: winget-pkgs
      branch: vx-{{.Version}}
      pull_request:
        enabled: true
        base:
          owner: microsoft
          name: winget-pkgs
          branch: master
    commit_author:
      name: goreleaserbot
      email: bot@goreleaser.com
    commit_msg_template: '{{ .PackageIdentifier }}: {{ .Tag }}'
    ids:
      - pgo
      - standard
    goamd64: v1
    skip_upload: auto
    url_template: https://github.com/loonghao/vx/releases/download/{{ .Tag }}/{{ .ArtifactName }}
    short_description: Universal Development Tool Manager
    description: vx is a universal development tool manager that helps developers manage multiple tools and their versions with automatic installation, version switching, and environment isolation.
    homepage: https://github.com/loonghao/vx
    license: mit
    license_url: https://github.com/loonghao/vx/blob/main/LICENSE
    release_notes: '{{.Changelog}}'
    tags:
      - development
      - tools
      - version-manager
      - cli
      - rust
    dependencies:
      - package_identifier: Git.Git
        minimum_version: 2.0.0
aurs:
  - name: vx-bin
    commit_author:
      name: goreleaserbot
      email: bot@goreleaser.com
    commit_msg_template: 'updpkg: {{ .ProjectName }} {{ .Tag }}'
    description: Universal Development Tool Manager - Manage multiple development tools and their versions
    homepage: https://github.com/loonghao/vx
    license: MIT
    skip_upload: auto
    maintainers:
      - Hal <hal.long@outlook.com>
    provides:
      - vx
    conflicts:
      - vx
    depends:
      - git
    optdepends:
      - 'curl: for downloading tools'
      - 'wget: alternative download method'
    rel: "1"
    package: |-
      # bin
      install -Dm755 "./vx" "${pkgdir}/usr/bin/vx"

      # license
      install -Dm644 "./LICENSE" "${pkgdir}/usr/share/licenses/vx/LICENSE"

      # documentation
      install -Dm644 "./README.md" "${pkgdir}/usr/share/doc/vx/README.md"
    git_url: ssh://aur@aur.archlinux.org/vx-bin.git
    private_key: '{{ .Env.AUR_KEY }}'
    goamd64: v1
scoops:
  - name: vx
    repository:
      owner: loonghao
      name: scoop-bucket
    commit_author:
      name: goreleaserbot
      email: bot@goreleaser.com
    commit_msg_template: '{{ .ProjectName }}: Update to {{ .Tag }}'
    homepage: https://github.com/loonghao/vx
    description: Universal Development Tool Manager - Manage multiple development tools and their versions
    license: MIT
    goamd64: v1
builds:
  - id: vx-standard
    targets:
      - x86_64-unknown-freebsd
      - x86_64-pc-windows-msvc
      - aarch64-unknown-linux-gnu
      - aarch64-unknown-linux-musl
      - aarch64-apple-darwin
      - aarch64-pc-windows-msvc
    dir: .
    main: .
    binary: vx
    hooks:
      pre:
        - cmd: rustup target add {{ .Target }}
    builder: rust
    tool: cargo
    command: build
    flags:
      - --release
      - --package=vx
    env:
      - RUST_BACKTRACE=1
archives:
  - id: pgo
    ids:
      - vx-pgo
    builds_info:
      mode: 493
    name_template: '{{ .ProjectName }}_ {{- title .Os }}_ {{- if eq .Arch "amd64" }}x86_64 {{- else if eq .Arch "386" }}i386 {{- else }}{{ .Arch }}{{ end }} {{- if .Arm }}v{{ .Arm }}{{ end }}_pgo'
    formats:
      - tar.gz
    files:
      - src: README.md
      - src: LICENSE
      - src: CHANGELOG.md
  - id: standard
    ids:
      - vx-standard
    builds_info:
      mode: 493
    name_template: '{{ .ProjectName }}_ {{- title .Os }}_ {{- if eq .Arch "amd64" }}x86_64 {{- else if eq .Arch "386" }}i386 {{- else }}{{ .Arch }}{{ end }} {{- if .Arm }}v{{ .Arm }}{{ end }}'
    formats:
      - tar.gz
    files:
      - src: README.md
      - src: LICENSE
      - src: CHANGELOG.md
nfpms:
  - file_name_template: '{{ .PackageName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}'
    package_name: vx
    dependencies:
      - git
    recommends:
      - curl
      - wget
    suggests:
      - build-essential
    contents:
      - src: ./README.md
        dst: /usr/share/doc/vx/README.md
      - src: ./LICENSE
        dst: /usr/share/doc/vx/LICENSE
      - src: ./CHANGELOG.md
        dst: /usr/share/doc/vx/CHANGELOG.md
    scripts:
      postinstall: |
        echo "vx has been installed successfully!"
        echo "Run 'vx --help' to get started."
        echo "Visit https://github.com/loonghao/vx for documentation."
      preremove: |
        echo "Removing vx..."
    id: packages
    formats:
      - deb
      - rpm
      - apk
      - archlinux
    section: utils
    priority: optional
    vendor: Hal
    homepage: https://github.com/loonghao/vx
    maintainer: Hal <hal.long@outlook.com>
    description: Universal Development Tool Manager - Manage multiple development tools and their versions
    license: MIT
    bindir: /usr/bin
    libdirs:
      header: /usr/include
      carchive: /usr/lib
      cshared: /usr/lib
    meta: true
snapshot:
  version_template: '{{ incpatch .Version }}-next'
checksum:
  name_template: checksums.txt
  algorithm: sha256
dockers:
  - goos: linux
    goarch: amd64
    goarm: "6"
    goamd64: v1
    dockerfile: Dockerfile
    image_templates:
      - ghcr.io/loonghao/vx:{{ .Version }}-amd64
      - ghcr.io/loonghao/vx:latest-amd64
    build_flag_templates:
      - --platform=linux/amd64
      - --label=org.opencontainers.image.created={{.Date}}
      - --label=org.opencontainers.image.title={{.ProjectName}}
      - --label=org.opencontainers.image.revision={{.FullCommit}}
      - --label=org.opencontainers.image.version={{.Version}}
    use: buildx
  - goos: linux
    goarch: arm64
    goarm: "6"
    goamd64: v1
    dockerfile: Dockerfile
    image_templates:
      - ghcr.io/loonghao/vx:{{ .Version }}-arm64v8
      - ghcr.io/loonghao/vx:latest-arm64v8
    build_flag_templates:
      - --platform=linux/arm64/v8
      - --label=org.opencontainers.image.created={{.Date}}
      - --label=org.opencontainers.image.title={{.ProjectName}}
      - --label=org.opencontainers.image.revision={{.FullCommit}}
      - --label=org.opencontainers.image.version={{.Version}}
    use: buildx
docker_manifests:
  - name_template: ghcr.io/loonghao/vx:{{ .Version }}
    image_templates:
      - ghcr.io/loonghao/vx:{{ .Version }}-amd64
      - ghcr.io/loonghao/vx:{{ .Version }}-arm64v8
    use: docker
  - name_template: ghcr.io/loonghao/vx:latest
    image_templates:
      - ghcr.io/loonghao/vx:latest-amd64
      - ghcr.io/loonghao/vx:latest-arm64v8
    use: docker
changelog:
  filters:
    exclude:
      - '^docs:'
      - '^test:'
      - '^ci:'
      - '^chore:'
      - '^style:'
      - Merge pull request
      - Merge branch
      - go mod tidy
  sort: asc
  use: github
  format: '{{ .SHA }}: {{ .Message }} ({{ with .AuthorUsername }}@{{ . }}{{ else }}{{ .AuthorName }} <{{ .AuthorEmail }}>{{ end }})'
  groups:
    - title: Features
      regexp: ^.*?feat(\([[:word:]]+\))??!?:.+$
    - title: Bug fixes
      regexp: ^.*?fix(\([[:word:]]+\))??!?:.+$
      order: 1
    - title: Performance improvements
      regexp: ^.*?perf(\([[:word:]]+\))??!?:.+$
      order: 2
    - title: Others
      order: 999
dist: dist
env_files:
  github_token: ~/.config/goreleaser/github_token
  gitlab_token: ~/.config/goreleaser/gitlab_token
  gitea_token: ~/.config/goreleaser/gitea_token
before:
  hooks:
    - rustup default stable
source:
  name_template: '{{ .ProjectName }}-{{ .Version }}'
  format: tar.gz
gomod:
  gobinary: go
announce:
  skip: '{{gt .Patch 0}}'
  twitter:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
  mastodon:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
    server: ""
  reddit:
    title_template: '{{ .ProjectName }} {{ .Tag }} is out!'
    url_template: '{{ .ReleaseURL }}'
  slack:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
    username: GoReleaser
  discord:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
    author: GoReleaser
    color: "3888754"
    icon_url: https://goreleaser.com/static/avatar.png
  teams:
    title_template: '{{ .ProjectName }} {{ .Tag }} is out!'
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
    color: '#2D313E'
    icon_url: https://goreleaser.com/static/avatar.png
  smtp:
    subject_template: '{{ .ProjectName }} {{ .Tag }} is out!'
    body_template: 'You can view details from: {{ .ReleaseURL }}'
  mattermost:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
    title_template: '{{ .ProjectName }} {{ .Tag }} is out!'
    username: GoReleaser
  linkedin:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
  telegram:
    message_template: '{{ mdv2escape .ProjectName }} {{ mdv2escape .Tag }} is out{{ mdv2escape "!" }} Check it out at {{ mdv2escape .ReleaseURL }}'
    parse_mode: MarkdownV2
  webhook:
    message_template: '{ "message": "{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}"}'
    content_type: application/json; charset=utf-8
    expected_status_codes:
      - 200
      - 201
      - 202
      - 204
  opencollective:
    title_template: '{{ .Tag }}'
    message_template: '{{ .ProjectName }} {{ .Tag }} is out!<br/>Check it out at <a href="{{ .ReleaseURL }}">{{ .ReleaseURL }}</a>'
  bluesky:
    message_template: '{{ .ProjectName }} {{ .Tag }} is out! Check it out at {{ .ReleaseURL }}'
chocolateys:
  - name: vx
    ids:
      - pgo
      - standard
    owners: Hal
    title: vx - Universal Development Tool Manager
    authors: Hal <hal.long@outlook.com>
    project_url: https://github.com/loonghao/vx
    url_template: https://github.com/loonghao/vx/releases/download/{{ .Tag }}/{{ .ArtifactName }}
    icon_url: https://raw.githubusercontent.com/loonghao/vx/main/docs/logo.png
    copyright: 2025 Hal
    license_url: https://github.com/loonghao/vx/blob/main/LICENSE
    project_source_url: https://github.com/loonghao/vx
    docs_url: https://github.com/loonghao/vx/blob/main/README.md
    bug_tracker_url: https://github.com/loonghao/vx/issues
    tags: development tools version manager cli rust
    summary: Universal Development Tool Manager - Manage multiple development tools and their versions
    description: |
      vx is a universal development tool manager that helps developers manage multiple tools and their versions.
      It supports automatic installation, version switching, and environment isolation for various development tools.
    release_notes: https://github.com/loonghao/vx/releases/tag/v{{ .Version }}
    dependencies:
      - id: git
    api_key: '{{ .Env.CHOCOLATEY_API_KEY }}'
    source_repo: https://push.chocolatey.org/
    goamd64: v1
git:
  tag_sort: -version:refname
github_urls:
  download: https://github.com
gitlab_urls:
  download: https://gitlab.com
